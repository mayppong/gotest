version: "2"
services:
  postgres:
    image: postgres:9.6
    environment:
      POSTGRES_DB: "gotest_test"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "postgres"

  # the main image, this is the application
  test:
    image: "elixir:1.5-alpine"
    environment:
      MIX_ENV: "test"
    command: sh -c "mix local.hex --force; mix local.rebar --force; mix test"
    working_dir: /gotest
    volumes:
      - ./:/gotest
    links:
      - postgres